
<!-- saved from url=(0022)http://localhost:3000/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252"><style type="text/css">.gm-style .gm-style-iw{font-weight:300;font-size:13px;overflow:hidden}.gm-style .gm-iw{color:#2c2c2c}.gm-style .gm-iw b{font-weight:400}.gm-style .gm-iw a:link,.gm-style .gm-iw a:visited{color:#4272db;text-decoration:none}.gm-style .gm-iw a:hover{color:#4272db;text-decoration:underline}.gm-style .gm-iw .gm-title{font-weight:400;margin-bottom:1px}.gm-style .gm-iw .gm-basicinfo{line-height:18px;padding-bottom:12px}.gm-style .gm-iw .gm-website{padding-top:6px}.gm-style .gm-iw .gm-photos{padding-bottom:8px;-ms-user-select:none;-moz-user-select:none;-webkit-user-select:none}.gm-style .gm-iw .gm-sv,.gm-style .gm-iw .gm-ph{cursor:pointer;height:50px;width:100px;position:relative;overflow:hidden}.gm-style .gm-iw .gm-sv{padding-right:4px}.gm-style .gm-iw .gm-wsv{cursor:pointer;position:relative;overflow:hidden}.gm-style .gm-iw .gm-sv-label,.gm-style .gm-iw .gm-ph-label{cursor:pointer;position:absolute;bottom:6px;color:#fff;font-weight:400;text-shadow:rgba(0,0,0,0.7) 0 1px 4px;font-size:12px}.gm-style .gm-iw .gm-stars-b,.gm-style .gm-iw .gm-stars-f{height:13px;font-size:0}.gm-style .gm-iw .gm-stars-b{position:relative;background-position:0 0;width:65px;top:3px;margin:0 5px}.gm-style .gm-iw .gm-rev{line-height:20px;-ms-user-select:none;-moz-user-select:none;-webkit-user-select:none}.gm-style.gm-china .gm-iw .gm-rev{display:none}.gm-style .gm-iw .gm-numeric-rev{font-size:16px;color:#dd4b39;font-weight:400}.gm-style .gm-iw.gm-transit{margin-left:15px}.gm-style .gm-iw.gm-transit td{vertical-align:top}.gm-style .gm-iw.gm-transit .gm-time{white-space:nowrap;color:#676767;font-weight:bold}.gm-style .gm-iw.gm-transit img{width:15px;height:15px;margin:1px 5px 0 -20px;float:left}.gm-iw {text-align:left;}.gm-iw .gm-numeric-rev {float:left;}.gm-iw .gm-photos,.gm-iw .gm-rev {direction:ltr;}.gm-iw .gm-stars-f, .gm-iw .gm-stars-b {background:url("https://maps.gstatic.com/mapfiles/api-3/images/review_stars.png") no-repeat;background-size: 65px 26px;float:left;}.gm-iw .gm-stars-f {background-position:left -13px;}.gm-iw .gm-sv-label,.gm-iw .gm-ph-label {left: 4px;}</style><style type="text/css">.gm-style .gm-style-mtc label,.gm-style .gm-style-mtc div{font-weight:400}</style><style type="text/css">.gm-style-pbc{transition:opacity ease-in-out;background-color:black;text-align:center}.gm-style-pbt{font-size:22px;color:white;font-family:Roboto,Arial,sans-serif;position:relative;margin:0;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%)}</style><link type="text/css" rel="stylesheet" href="./600 tweets (from searches), 4_3_2016 (prev week)_files/css"><style type="text/css">.gm-style .gm-style-cc span,.gm-style .gm-style-cc a,.gm-style .gm-style-mtc div{font-size:10px}</style><style type="text/css">@media print {  .gm-style .gmnoprint, .gmnoprint {    display:none  }}@media screen {  .gm-style .gmnoscreen, .gmnoscreen {    display:none  }}</style><style type="text/css">.gm-style{font-family:Roboto,Arial,sans-serif;font-size:11px;font-weight:400;text-decoration:none}.gm-style img{max-width:none}</style>  
   <link rel="stylesheet" type="text/css" href="./600 tweets (from searches), 4_3_2016 (prev week)_files/style.css">
   
   <title>Insert title here</title>
   <script src="./600 tweets (from searches), 4_3_2016 (prev week)_files/init.js"></script>   
   <script src="./600 tweets (from searches), 4_3_2016 (prev week)_files/js" async="" defer=""></script>
    <script id="bingScript" type="text/javascript" src="./600 tweets (from searches), 4_3_2016 (prev week)_files/Locations"></script>
<script type="text/javascript" charset="UTF-8" src="./600 tweets (from searches), 4_3_2016 (prev week)_files/common.js"></script><script type="text/javascript" charset="UTF-8" src="./600 tweets (from searches), 4_3_2016 (prev week)_files/util.js"></script><script type="text/javascript" charset="UTF-8" src="./600 tweets (from searches), 4_3_2016 (prev week)_files/geocoder.js"></script><script type="text/javascript" charset="UTF-8" src="./600 tweets (from searches), 4_3_2016 (prev week)_files/map.js"></script><script type="text/javascript" charset="UTF-8" src="./600 tweets (from searches), 4_3_2016 (prev week)_files/geometry.js"></script><script type="text/javascript" charset="UTF-8" src="./600 tweets (from searches), 4_3_2016 (prev week)_files/poly.js"></script><script type="text/javascript" charset="UTF-8" src="./600 tweets (from searches), 4_3_2016 (prev week)_files/onion.js"></script><script type="text/javascript" charset="UTF-8" src="./600 tweets (from searches), 4_3_2016 (prev week)_files/stats.js"></script><script type="text/javascript" charset="UTF-8" src="./600 tweets (from searches), 4_3_2016 (prev week)_files/controls.js"></script><script type="text/javascript" charset="UTF-8" src="./600 tweets (from searches), 4_3_2016 (prev week)_files/infowindow.js"></script></head>
<body>
  <br>  
<section>  
  <div class="map" id="map" style="position: relative; overflow: hidden; transform: translateZ(0px); background-color: rgb(229, 227, 223);"><div class="gm-style" style="position: absolute; left: 0px; top: 0px; overflow: hidden; width: 100%; height: 100%; z-index: 0;"><div style="position: absolute; left: 0px; top: 0px; overflow: hidden; width: 100%; height: 100%; z-index: 0; cursor: url(&quot;https://maps.gstatic.com/mapfiles/openhand_8_8.cur&quot;) 8 8, default;"><div style="position: absolute; left: 0px; top: 0px; z-index: 1; width: 100%; transform-origin: 0px 0px 0px; transform: matrix(1, 0, 0, 1, 3509, 186);"><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 100; width: 100%;"><div style="position: absolute; left: 0px; top: 0px; z-index: 0;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -3195px; top: -157px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -3195px; top: 99px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -2939px; top: -157px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -2939px; top: 99px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -3195px; top: 355px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -3195px; top: -413px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -2939px; top: -413px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -3451px; top: -157px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -2683px; top: -157px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -3451px; top: 99px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -2683px; top: 99px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -2939px; top: 355px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -2683px; top: -413px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -3451px; top: -413px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -3451px; top: 355px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -2683px; top: 355px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -3707px; top: 99px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -2427px; top: 99px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -2427px; top: -157px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -3707px; top: -157px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -2427px; top: -413px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -3707px; top: -413px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -3707px; top: 355px;"></div><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -2427px; top: 355px;"></div></div></div></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 101; width: 100%;"><div style="position: absolute; left: 0px; top: 0px; z-index: 30;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -3195px; top: -157px;"></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -3195px; top: 99px;"><canvas width="256" height="256" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"></canvas></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -2939px; top: -157px;"></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -2939px; top: 99px;"><canvas width="256" height="256" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"></canvas></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -3195px; top: 355px;"><canvas width="256" height="256" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"></canvas></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -3195px; top: -413px;"></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -2939px; top: -413px;"></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -3451px; top: -157px;"></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -2683px; top: -157px;"></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -3451px; top: 99px;"><canvas width="256" height="256" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"></canvas></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -2683px; top: 99px;"><canvas width="256" height="256" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"></canvas></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -2939px; top: 355px;"><canvas width="256" height="256" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"></canvas></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -2683px; top: -413px;"></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -3451px; top: -413px;"></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -3451px; top: 355px;"><canvas width="256" height="256" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"></canvas></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -2683px; top: 355px;"><canvas width="256" height="256" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"></canvas></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -3707px; top: 99px;"><canvas width="256" height="256" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"></canvas></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -2427px; top: 99px;"><canvas width="256" height="256" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"></canvas></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -2427px; top: -157px;"></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -3707px; top: -157px;"></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -2427px; top: -413px;"></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -3707px; top: -413px;"></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -3707px; top: 355px;"><canvas width="256" height="256" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"></canvas></div><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -2427px; top: 355px;"><canvas width="256" height="256" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"></canvas></div></div></div></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 102; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 103; width: 100%;"></div><div style="position: absolute; left: 0px; top: 0px; z-index: 0;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="transform: translateZ(0px); position: absolute; left: -3195px; top: -413px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/transparent.png" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -2939px; top: -413px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/transparent.png" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -2683px; top: -413px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/transparent.png" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -3451px; top: -413px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/transparent.png" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -2427px; top: -413px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/transparent.png" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -3707px; top: -413px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/transparent.png" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -3195px; top: -157px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -3195px; top: 99px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(1)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -2939px; top: -157px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(2)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -2939px; top: 99px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(3)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -3195px; top: 355px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(4)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -3451px; top: -157px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(5)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -2427px; top: -157px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(5)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -3707px; top: -157px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(6)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -2683px; top: -157px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(6)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -3451px; top: 99px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(7)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -2427px; top: 99px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(7)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -2939px; top: 355px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(8)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -2427px; top: 355px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(9)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -3451px; top: 355px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(9)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -2683px; top: 355px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(10)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -3707px; top: 355px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(10)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -3707px; top: 99px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(11)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div style="transform: translateZ(0px); position: absolute; left: -2683px; top: 99px; transition: opacity 200ms ease-out;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/vt(11)" draggable="false" alt="" style="position: absolute; left: 0px; top: 0px; width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div></div></div></div><div class="gm-style-pbc" style="position: absolute; left: 0px; top: 0px; z-index: 2; width: 100%; height: 100%; transition-duration: 0.3s; opacity: 0; display: none;"><p class="gm-style-pbt">Use two fingers to move the map</p></div><div style="position: absolute; left: 0px; top: 0px; z-index: 3; width: 100%; height: 100%;"></div><div style="position: absolute; left: 0px; top: 0px; z-index: 4; width: 100%; transform-origin: 0px 0px 0px; transform: matrix(1, 0, 0, 1, 3509, 186);"><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 104; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 105; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 106; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 107; width: 100%;"><div style="z-index: -202; cursor: pointer; transform: translateZ(0px); display: none;"><div style="width: 30px; height: 27px; overflow: hidden; position: absolute;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/undo_poly.png" draggable="false" style="position: absolute; left: 0px; top: 0px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none; width: 90px; height: 27px;"></div></div></div></div></div><div style="margin-left: 5px; margin-right: 5px; z-index: 1000000; position: absolute; left: 0px; bottom: 0px;"><a target="_blank" href="https://maps.google.com/maps?ll=50.189004,-97.624738&amp;z=2&amp;hl=en-US&amp;gl=US&amp;mapclient=apiv3" title="Click to see this area on Google Maps" style="position: static; overflow: visible; float: none; display: inline;"><div style="width: 66px; height: 26px; cursor: pointer;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/google_white5.png" draggable="false" style="position: absolute; left: 0px; top: 0px; width: 66px; height: 26px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></a></div><div style="padding: 15px 21px; border: 1px solid rgb(171, 171, 171); font-family: Roboto, Arial, sans-serif; color: rgb(34, 34, 34); box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 16px; z-index: 10000002; display: none; width: 256px; height: 148px; position: absolute; left: 399px; top: 285px; background-color: white;"><div style="padding: 0px 0px 10px; font-size: 16px;">Map Data</div><div style="font-size: 13px;">Map data ©2016</div><div style="width: 13px; height: 13px; overflow: hidden; position: absolute; opacity: 0.7; right: 12px; top: 12px; z-index: 10000; cursor: pointer;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/mapcnt6.png" draggable="false" style="position: absolute; left: -2px; top: -336px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div></div><div class="gmnoprint" style="z-index: 1000001; position: absolute; right: 71px; bottom: 0px; width: 87px;"><div draggable="false" class="gm-style-cc" style="-webkit-user-select: none; height: 14px; line-height: 14px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right; vertical-align: middle; display: inline-block;"><a style="color: rgb(68, 68, 68); text-decoration: none; cursor: pointer; display: none;">Map Data</a><span>Map data ©2016</span></div></div></div><div class="gmnoscreen" style="position: absolute; right: 0px; bottom: 0px;"><div style="font-family: Roboto, Arial, sans-serif; font-size: 11px; color: rgb(68, 68, 68); direction: ltr; text-align: right; background-color: rgb(245, 245, 245);">Map data ©2016</div></div><div class="gmnoprint gm-style-cc" draggable="false" style="z-index: 1000001; -webkit-user-select: none; height: 14px; line-height: 14px; position: absolute; right: 0px; bottom: 0px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right; vertical-align: middle; display: inline-block;"><a href="https://www.google.com/intl/en-US_US/help/terms_maps.html" target="_blank" style="text-decoration: none; cursor: pointer; color: rgb(68, 68, 68);">Terms of Use</a></div></div><div style="width: 25px; height: 25px; overflow: hidden; display: none; margin: 10px 14px; position: absolute; top: 0px; right: 0px;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/sv5.png" draggable="false" class="gm-fullscreen-control" style="position: absolute; left: -52px; top: -86px; width: 164px; height: 112px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div draggable="false" class="gm-style-cc" style="-webkit-user-select: none; height: 14px; line-height: 14px; display: none; position: absolute; right: 0px; bottom: 0px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right; vertical-align: middle; display: inline-block;"><a target="_new" title="Report errors in the road map or imagery to Google" href="https://www.google.com/maps/@50.1890041,-817.6247382,2z/data=!10m1!1e1!12b1?source=apiv3&amp;rapsrc=apiv3" style="font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); text-decoration: none; position: relative;">Report a map error</a></div></div><div class="gmnoprint gm-bundled-control gm-bundled-control-on-bottom" draggable="false" controlwidth="28" controlheight="55" style="margin: 10px; -webkit-user-select: none; position: absolute; bottom: 69px; right: 28px;"><div class="gmnoprint" controlwidth="28" controlheight="55" style="position: absolute; left: 0px; top: 0px;"><div draggable="false" style="-webkit-user-select: none; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; border-radius: 2px; cursor: pointer; width: 28px; height: 55px; background-color: rgb(255, 255, 255);"><div title="Zoom in" style="position: relative; width: 28px; height: 27px; left: 0px; top: 0px;"><div style="overflow: hidden; position: absolute; width: 15px; height: 15px; left: 7px; top: 6px;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/tmapctrl.png" draggable="false" style="position: absolute; left: 0px; top: 0px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none; width: 120px; height: 54px;"></div></div><div style="position: relative; overflow: hidden; width: 67%; height: 1px; left: 16%; top: 0px; background-color: rgb(230, 230, 230);"></div><div title="Zoom out" style="position: relative; width: 28px; height: 27px; left: 0px; top: 0px;"><div style="overflow: hidden; position: absolute; width: 15px; height: 15px; left: 7px; top: 6px;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/tmapctrl.png" draggable="false" style="position: absolute; left: 0px; top: -15px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none; width: 120px; height: 54px;"></div></div></div></div><div class="gmnoprint" controlwidth="28" controlheight="0" style="display: none; position: absolute;"><div title="Rotate map 90 degrees" style="width: 28px; height: 28px; overflow: hidden; position: absolute; border-radius: 2px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; cursor: pointer; display: none; background-color: rgb(255, 255, 255);"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/tmapctrl4.png" draggable="false" style="position: absolute; left: -141px; top: 6px; width: 170px; height: 54px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div><div class="gm-tilt" style="width: 28px; height: 28px; overflow: hidden; position: absolute; border-radius: 2px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; top: 0px; cursor: pointer; background-color: rgb(255, 255, 255);"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/tmapctrl4.png" draggable="false" style="position: absolute; left: -141px; top: -13px; width: 170px; height: 54px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none;"></div></div></div><div class="gmnoprint" style="margin: 10px; z-index: 0; position: absolute; cursor: pointer; left: 0px; top: 0px;"><div class="gm-style-mtc" style="float: left;"><div draggable="false" title="Show street map" style="direction: ltr; overflow: hidden; text-align: center; position: relative; color: rgb(86, 86, 86); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 8px; border-bottom-left-radius: 2px; border-top-left-radius: 2px; -webkit-background-clip: padding-box; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; min-width: 21px; background-color: rgb(255, 255, 255); background-clip: padding-box;">Map</div><div style="z-index: -1; padding: 2px; border-bottom-left-radius: 2px; border-bottom-right-radius: 2px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; position: absolute; left: 0px; top: 29px; text-align: left; display: none; background-color: white;"><div draggable="false" title="Show street map with terrain" style="color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 6px 8px 6px 6px; direction: ltr; text-align: left; white-space: nowrap; background-color: rgb(255, 255, 255);"><span role="checkbox" style="box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);"><div style="position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden; display: none;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/imgs8.png" draggable="false" style="position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none; width: 68px; height: 67px;"></div></span><label style="vertical-align: middle; cursor: pointer;">Terrain</label></div></div></div><div class="gm-style-mtc" style="float: left;"><div draggable="false" title="Show satellite imagery" style="direction: ltr; overflow: hidden; text-align: center; position: relative; color: rgb(86, 86, 86); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 8px; border-bottom-right-radius: 2px; border-top-right-radius: 2px; -webkit-background-clip: padding-box; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; border-left-width: 0px; min-width: 37px; background-color: rgb(255, 255, 255); background-clip: padding-box;">Satellite</div><div style="z-index: -1; padding: 2px; border-bottom-left-radius: 2px; border-bottom-right-radius: 2px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; position: absolute; right: 0px; top: 29px; text-align: left; display: none; background-color: white;"><div draggable="false" title="Show imagery with street names" style="color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 6px 8px 6px 6px; direction: ltr; text-align: left; white-space: nowrap; background-color: rgb(255, 255, 255);"><span role="checkbox" style="box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);"><div style="position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden;"><img src="./600 tweets (from searches), 4_3_2016 (prev week)_files/imgs8.png" draggable="false" style="position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; max-width: none; width: 68px; height: 67px;"></div></span><label style="vertical-align: middle; cursor: pointer;">Labels</label></div></div></div></div></div></div>    
  <div id="text-div">
      <textarea name="text" id="textar" cols="5" rows="25" class="central textAr">       Live streaming tweets...
      </textarea>   
  </div>
</section>          
<div id="hidden-div" style="display: block;">
  <div class="div-color boxes">
      <div class="color-box" id="mood-div" style="background-color: rgb(127, 127, 127);">Current Tweet Mood</div>
  </div>
  <div class="div-color">
      <div class="color-box2" id="globalMood-div" style="background-color: rgb(127, 133, 133);">Average Tweet Mood</div>
  </div>
    <br><br>

  <div id="button-div">
    <table>
      <tbody><tr>
        <td>
          <button type="button" id="pause-btn" name="pause" onclick="buttonHandler(this)" method="post">Pause Mapping</button>
        </td>
        <td> 
          <button type="button" id="clear-btn" name="clear" onclick="buttonHandler(this)" method="post">Clear Map
          </button>
        </td>
        <td>
          <button type="button" id="togCircVis-btn" name="togCircVis" style="display: block" onclick="buttonHandler(this)" method="post">Show Circles</button>
        </td>    
      </tr>         
    </tbody></table>
    <br>      
    <span> Note: You can always pause your streaming, change the parameters in your form, then click 'Resume Mapping'. This will show you your new  results on top of the current map. Hit 'Clear Map' to avoid overlapping results. </span>          
    <br>                                         
  </div>  
    <br><br>       
</div>
  <br>

<!-- Note the use of a button rather than input to submit form; prevents
page refresh, to preserve utility of ajax-->

  <div class="form central" id="form-input">
     <form id="form" style="display: none;">
       <fieldset>
         <legend>Your guidelines:</legend>

              What subject do you want to follow?<br>
           <input type="text" id="subject" value="BernieSanders"><br>

             Choose a start date for a search, up to one week ago: <br>
           <input type="text" id="startdate" value="3/28/2016" placeholder="day/month/2016"><br>
           <textarea name="error1" id="starterror" cols="100" rows="3" style="display: block;">Not quite. Please correct the following: </textarea>   
           
             Choose an end date for your search: <br>
           <input type="text" id="enddate" value="3/30/2016" placeholder="day/month/2016"><br>       
           <textarea name="error2" id="enderror" cols="110" rows="4" style="display:none">Not quite. Please correct the following: </textarea>   
           
             Select your search mode.<br>   
            <select name="modeOptions" form="form-input" id="modeOptions">
              <option value="/getTweets">Search Twitter</option>
              <option value="/streamTweets">Live Stream</option>
            </select>

           <br><br>
           <button type="button" id="submit-btn" onclick="buttonHandler(this)" name="submit" style="display: none;" method="post">Submit</button>  
       </fieldset>
     </form>
  </div>

<script type="text/javascript">

const ReachBoost = 750;
const DefaultCenter = {'lat': -3.8963993, 'lng': -146.42578125};
const Week = xBrowserWeek();

// Apparently cross-browser standardization of date construction is not so consistent, so I use this as a golden standard: 
function xBrowserWeek(){
  var pointA = new Date('3/3/2016');
  var pointB = new Date('3/10/2016'); 
  return pointB - pointA;
}     
bingCallback = function(){};

var xhr = new XMLHttpRequest();
var globalMood = {"mood" : [0,0,0], "count" : 1 };
var geoCoder;
var turnstileCount = 0;
var map;  
var startErrMsg;
var endErrMsg;

// Execute functions according to button clicks. Note the flexibility in the logic of clickWrapper(a,b,c,d,e,f) --
// it MUST have the first 4 arguments, but also works with either 5 or 6 args (extras as optional callbacks).
function buttonHandler(source){
  var name  = source.name;

  switch (name){
    case 'submit':
      if (formValidates()){
        onclickWrapper(document.getElementById('hidden-div').style, 'display', false, 'block', 'none', ajaxFormSubmit);
        batchHide(['submit-btn','starterror','enderror','form']);
        document.getElementById('textar').style = 'display:block-inline';
      } else {
        showErrorMsgs();
      }
      break;
    case 'pause':
      if (formValidates()){
        onclickWrapper(document.getElementById('pause-btn').firstChild, 'data', true,'Pause Mapping', 'Resume Mapping',ajaxPauseStream,ajaxFormSubmit);
        onclickWrapper(document.getElementById('form').style, 'display', true, 'block', 'none');  
      } else {
        showErrorMsgs();
      }
      break;        
    case 'togCircVis':
      onclickWrapper(document.getElementById('togCircVis-btn').firstChild, 'data', true, 'Show Circles', 'Hide Circles', map._togCircVis.call(map));
      break;
    case 'clear':
      map._clearCircles();
      document.getElementById('togCircVis-btn').style.display = 'none';
      document.getElementById('togCircVis-btn').firstChild.data = 'Hide Circles';
      break;       
  }

/*
  Refer to Readme.md "III: onclickWrapper(elem, prop, toggleEnabled, newVal, oldVal, newOnClickMthd, oldOnClickMthd)" for an explanation of this 
  function.
 */ 

  function onclickWrapper(elem, prop, toggleEnabled, newVal, oldVal, newOnClickMthd, oldOnClickMthd){
    if(toggleEnabled) {
      elem[prop] == oldVal ? clickAction(newVal, oldOnClickMthd) : clickAction(oldVal, newOnClickMthd);
    } else {
      elem[prop] = newVal;
      if (newOnClickMthd){
        newOnClickMthd();
      }    
    }

    function clickAction(value, callback){
      elem[prop] = value;
      if (!callback && newOnClickMthd){
        callback = newOnClickMthd;
      }
      if (callback){        
        callback();
      }
    }
  }

  function batchHide(toBeHidden){
    toBeHidden.forEach(function(elem){
      document.getElementById(elem).style.display = 'none';
    })
  }

  function showErrorMsgs(){
    if (startErrMsg.length > 0){      
      document.getElementById('starterror').value = startErrMsg;
      document.getElementById('starterror').style.display = 'block';          
    }
    if (endErrMsg.length > 0) {  
      document.getElementById('enderror').value = endErrMsg;
      document.getElementById('enderror').style.display = 'block';          
    }
  }  
}

function formValidates(){
    var start    = document.getElementById('startdate').value;
    var end      = document.getElementById('enddate').value;
    var startObj = new Date(start);
    var endObj   = new Date(end);
    startErrMsg  = '';
    endErrMsg    = '';

    // & forces all to be checked; && would stop checking if first is invalidated. Needed to see all error messages.
    return (withinWeek() & validStart() & hasFormat());

    function withinWeek(){
      var now = new Date();
      if ((now - startObj) < Week){
        return true; 
      } else {
         startErrMsg += 'That start date is too long ago. Twitter only allows searches for roughly a week back. ';
        return false;
      }
    }

    function validStart(){
      if ((endObj - startObj) > 0){
        return true;    
      } else {
          endErrMsg += 'Please make sure your end date is after your start date. '
        return false;
      }
    }

    function hasFormat(){

      if (!checkSizes(start)){
        if (startErrMsg.length > 0){
          startErrMsg += 'Also: '
        }
        startErrMsg += 'Incorrect format. Please stick to day/month/year.'
      }
      if (!checkSizes(end)){
        if (endErrMsg.length > 0){
          endErrMsg += 'Also: '
        }        
        endErrMsg += 'Incorrect format. Please stick to day/month/year.' 
      }

      return (checkSizes(end) && checkSizes(start)) ? true : false;

      function checkSizes(date){
        date = date.split('/');
        if (date.length != 3){
          return false;
        } else {
          if ( (date[0].length > 0 && date[0].length < 3) 
            && (date[1].length > 0 && date[1].length < 3)
            && (date[2].length === 4)){
            return true;
          }
        }  
        return false;
      }
    }
  }  

function ajaxPauseStream(){

    // Abort should be sufficient. The request below is a fail safe measure to ensure twitter streaming stops.
  xhr.abort();      
  var pauseXhr = new XMLHttpRequest();
  pauseXhr.open('POST','../pauseStream', true);
  pauseXhr.setRequestHeader('Content-Type','text/plain');
  pauseXhr.send();

  pauseXhr.onreadystatechange = function(){
    if (this.readyState === XMLHttpRequest.DONE && this.status === 200){
      document.getElementById("textar").value = 'Streaming paused \n\n' + document.getElementById("textar").value;
    } else {
        //alert('There was a problem with the request.')
    }
  }
};         


function ajaxFormSubmit(){

  // Redundant check for validation (fail-safe)
  if (formValidates()){
    sendData(serializeForm());
    document.getElementById('togCircVis-btn').style.display = 'block';        
  } 

  function serializeForm(){
    var data = {'subject' : document.getElementById("subject").value,
                'start'   : document.getElementById("startdate").value,
                'end'     : document.getElementById("enddate").value}

    var urlEncodedData = "";
    var urlEncodedDataPairs = [];

    for (var name in data){
        urlEncodedDataPairs.push(encodeURIComponent(name) + '=' + encodeURIComponent(data[name]));
    }
    return [urlEncodedDataPairs.join('&').replace(/%20/g, '+'), document.getElementById("modeOptions").value];
  }

  function sendData(data){

    xhr.open('POST', data[1], true);
    xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
    xhr.send(data[0]);
    xhr.onreadystatechange = function (){

      if ((this.readyState === XMLHttpRequest.LOADING ||
           this.readyState === XMLHttpRequest.DONE) && this.status === 200) {
        var responseJSON = parseResponse(this.responseText);
        } else {
            // alert('There was a problem with the request.')
      }

      function parseResponse(response){
        // '{"text":"'' delimits the start of a new tweet -- the flaw being, if '{"text":"' occurs
        // in a tweet, the code will think everything subsequent is a new tweet. 
        var jsonTweet = JSON.parse(response.substring(response.lastIndexOf('{"text":"'), response.length));
        displayText(document.getElementById('textar'));
        updateMoodBox(document.getElementById('mood-div'), jsonTweet.stats.mood);
        updateAverageMoodBox(jsonTweet.stats.mood);
        geoCodeTweet(jsonTweet);
        return jsonTweet;

        function displayText(html){
          html.value = (html.value + '\n\n' + jsonTweet.text + '\n\n' + ' . .  .   .  . .  .   .  . .');
        }
         
        function updateMoodBox(html, mood){
          mood = mood.toString();
          html.style = 'background-color: RGB(' + mood + ')';  
        }
          
        function updateAverageMoodBox(mood){
          var RGB = [];
          mood.forEach(function(value, i){
            globalMood.mood[i] += Number(value);
            RGB[i] = (globalMood.mood[i] / globalMood.count).toFixed(0);
          }) 
          updateMoodBox(document.getElementById('globalMood-div'), RGB);
          globalMood.count++;
        }

        function geoCodeTweet(tweet){
          var center  = null;
          if (tweet.location != null){
            var location = tweet.location.substring(3, tweet.location.length);
            var id       = tweet.location.substring(0, 3);
            switch(id){
              case 'CO:':
                alert("~~~~ CO FOUND: Location is " + location)
                var latLng = location.split(",");
                center = {'lat': Number(latLng[0]), 'lng': Number(latLng[1])};
                alert("CO center is " + center.lat + " " + center.lng);
                break;
              case 'UL:':
                switch(turnstileCount){
                  case 0:
                    turnstileCount++;    console.log('google')
                    geoCoder.geocode({'address':location}, function(results, status){
                      if (status == google.maps.GeocoderStatus.OK){
                          if (results[0].geometry != null && results[0].geometry.location != null){
                            center = results[0].geometry.location;
                            drawTweetCircle(tweet, center, 'google');
                          }                     
                        } else if (status == google.maps.GeocoderStatus.OVER_QUERY_LIMIT){
                          alert('Oh no! This app has maxed out its queries. Try again later.')
                        }  
                      });
                      break;
                  case 1:  
                    turnstileCount++; console.log('mapquest')                
                    var mapQuestXHR = new XMLHttpRequest(); 
                    mapQuestXHR.open('GET', 'http://www.mapquestapi.com/geocoding/v1/address?key=bTOgIMAbO4p0SvZmAgD9EIFVxqO2MocO&maxResults=1&location=' + location);
                    mapQuestXHR.send();
                    mapQuestXHR.onreadystatechange = function() {
                      if (mapQuestXHR.readyState == XMLHttpRequest.DONE && mapQuestXHR.status == 200) {
                        var response = JSON.parse(mapQuestXHR.responseText);
                        if (response.results[0]){
                          center = response.results[0].locations[0].latLng;
                          if (center) {
                            drawTweetCircle(tweet, center, 'mapQuest')
                          }
                        }  
                      } 
                    };
                    break; 
                  case 2:
                    turnstileCount++; console.log('openCage')
                    var openCageXHR = new XMLHttpRequest(); 
                    openCageXHR.open('GET', 'http://api.opencagedata.com/geocode/v1/json?q=' + location + '&key=02b58331c3075f21b23ab96521c85d81&limit=1');
                    openCageXHR.send();
                     
                    openCageXHR.onreadystatechange = function() {
                      if (openCageXHR.readyState == XMLHttpRequest.DONE && openCageXHR.status == 200) {
                        var response = JSON.parse(openCageXHR.responseText);
                        if(response.results[0]){
                          center = response.results[0].geometry;
                          if (center) {
                            drawTweetCircle(tweet, center,' openCage')
                          }
                        }
                      } 
                    };
                  case 3:
                    turnstileCount = 0; console.log('bing')

                    var geocodeRequest = 'http://dev.virtualearth.net/REST/v1/Locations?query=' + location
                      + '&maxResults=1&key=Ap-VHxhCSyNJIBPYQptUIuYtx-CRsgCFFbWSLk6bmynl5Di_xn0CerxeblD-kVEb&jsonp=bingCallback';

                    bingScript.setAttribute('src', geocodeRequest);                                             

                    bingCallback = function(response){ 
                      if(response.resourceSets[0]){
                        center = response.resourceSets[0].resources[0].point.coordinates;
                        console.log(center)
                        center = {'lat': Number(center[0]), 'lng': Number(center[1])}
                        console.log(center)
                        if (center) {
                          drawTweetCircle(tweet, center, 'bing')
                        }
                      }
                    }
                    break;
                }    
              break;
            }
          } else if (location == null || center == null){
          // The middle of Iceland, for non-located tweets!
            center = DefaultCenter;
          }
          drawTweetCircle(tweet, center,'default');   
        } 

        function drawTweetCircle(tweet, center, source){
          var radius      = setRadius();
          var tweetCircle = initTweetCircle();
          tweetCircle.initListeners();
          tweetCircle._storeInMap(map);

          function setRadius(){
            var rad = tweet.stats.reach;
            if (rad){
              rad > 50000 ? rad *= 20 : rad = ((500000 - 10 * rad) * .000095 * rad);
            } else {
              rad = 90000;
            }
            return rad;
          }

          function initTweetCircle(){
              
            var circle = new google.maps.Circle({
              'strokeColor'  : 'RGB(' + tweet.stats.mood.toString() + ')',
              'strokeOpacity': .8,
              'strokeWeight' : 2,
              'fillColor'    : 'RGB(' + tweet.stats.mood.toString() + ')',
              'fillOpacity'  : .35, 
              'map'          : map,
              'center'       : center,
              'radius'       : radius,
              'draggable'    : true,
              'clickable'    : true,
              'geodesic'     : false,
            });

            circle.infoWindow = initInfoWindow(); 
            circle.timer;

            function initInfoWindow(){
              var content = ("<p>"
                            + "User:<br/> "     + tweet.user.name   + "<br/>" 
                            + "Text:<br/> "     + tweet.text        + "<br/>" 
                            + "Location:<br/> " + tweet.location    + "<br/>" 
                            + "Mood:<br/> "     + tweet.stats.mood  + "<br/>" 
                            + "Reach:<br/> "    + tweet.stats.reach + "<br/>" 
                            + "Reach:<br/> "    + tweet.stats.reach + "<br/>"
                            + "Provider:<br/> " + source            + "<br/>"
                            + "</p>");
              return new google.maps.InfoWindow({
                'content'        : content,
                'maxWidth'       : 325,
                'disableAutoPan' : true,
              });
            }

            circle.initListeners = function(){

              this.addListener('mouseover', function(){
                explodeView();
                this.infoWindow.setPosition(this.getBounds().getNorthEast());
                this.infoWindow.open(map);/*
                this.timer = setInterval(function(){
                    map.panTo(this.getCenter());
                  }.bind(circle), 2500);*/

                function explodeView(){
                  circle.setRadius(radius * 1.15);
                }  
              });
     
              this.addListener('mouseout', function(){
                this.setRadius(radius);
                this.infoWindow.close(map);
                clearTimeout(this.timer);
              });

              this.addListener('drag', function(){
                this.infoWindow.setMap(null);
              });

              this.addListener('dragend', function(){
                this.setMap(map);
                this.infoWindow.setPosition(this.getBounds().getNorthEast());
                this.infoWindow.setMap(map);
              });

              this.addListener('dblclick', function(){
                this.infoWindow.setMap(null);
                this.setMap(null);
              });            
            }
            return circle; 
          }
        }          
      }
    }         
  }
}

</script>



</body></html>